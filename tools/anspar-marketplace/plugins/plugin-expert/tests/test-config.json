{
  "tests": {
    "metadata": {
      "name": "Plugin Metadata Tests",
      "tests": [
        {
          "name": "Valid plugin.json structure",
          "type": "validation",
          "target": ".claude-plugin/plugin.json",
          "checks": [
            {
              "field": "name",
              "required": true,
              "pattern": {}
            },
            {
              "field": "version",
              "required": true,
              "pattern": {}
            },
            {
              "field": "description",
              "required": true,
              "minLength": 1,
              "maxLength": 500
            },
            {
              "field": "author",
              "required": true,
              "type": "object"
            },
            {
              "field": "author.name",
              "required": true,
              "minLength": 1
            }
          ]
        },
        {
          "name": "Valid marketplace.json if present",
          "type": "validation",
          "target": ".claude-plugin/marketplace.json",
          "optional": true,
          "checks": [
            {
              "field": "plugins",
              "required": true,
              "type": "array"
            },
            {
              "field": "owner",
              "required": true,
              "type": "object"
            }
          ]
        }
      ]
    },
    "commands": [
      {
        "name": "Command: create-plugin",
        "tests": [
          {
            "name": "Command file exists",
            "type": "file-exists",
            "target": "commands/create-plugin.md"
          },
          {
            "name": "Valid frontmatter",
            "type": "frontmatter-validation",
            "target": "commands/create-plugin.md",
            "checks": [
              {
                "field": "name",
                "required": true
              },
              {
                "field": "description",
                "required": true
              },
              {
                "field": "arguments",
                "required": true
              }
            ]
          },
          {
            "name": "Command execution test",
            "type": "execution",
            "command": "create-plugin",
            "args": [
              "--help"
            ],
            "expectedOutput": "should show help information",
            "expectedError": false
          }
        ]
      }
    ],
    "agents": [
      {
        "name": "Agent: PluginExpert",
        "tests": [
          {
            "name": "Agent file exists",
            "type": "file-exists",
            "target": "agents/PluginExpert.md"
          },
          {
            "name": "Valid agent structure",
            "type": "content-validation",
            "target": "agents/PluginExpert.md",
            "checks": [
              {
                "contains": "# Role"
              },
              {
                "contains": "PluginExpert"
              }
            ]
          },
          {
            "name": "Agent invocation test",
            "type": "agent-invocation",
            "agent": "PluginExpert",
            "input": "Create a simple data analysis plugin",
            "expectedBehavior": "Provides expert guidance and generates plugin structure"
          }
        ]
      }
    ],
    "skills": [],
    "hooks": [],
    "integration": [
      {
        "name": "Plugin loads successfully",
        "type": "plugin-load",
        "pluginPath": ".",
        "expectedComponents": [
          "commands",
          "agents"
        ]
      },
      {
        "name": "Commands and agents interact correctly",
        "type": "component-interaction",
        "scenario": "Command invokes agent",
        "steps": [
          {
            "action": "invoke-command",
            "target": "create-plugin"
          },
          {
            "verify": "agent-activated",
            "target": "PluginExpert"
          }
        ]
      },
      {
        "name": "Error handling works correctly",
        "type": "error-handling",
        "scenarios": [
          {
            "name": "Invalid command arguments",
            "action": "invoke-command",
            "args": [
              "--invalid-arg"
            ],
            "expectedError": true
          },
          {
            "name": "Hook timeout handling",
            "action": "trigger-hook",
            "event": "before-tool-use",
            "simulateTimeout": true,
            "expectedBehavior": "graceful-failure"
          }
        ]
      }
    ]
  },
  "runner": "bash",
  "timeout": 30000
}