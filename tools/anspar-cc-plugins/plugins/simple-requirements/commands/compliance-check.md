---
name: compliance-check
description: Run pre-PR compliance check with optional AI analysis and Linear ticket creation
arguments: "[--with-analysis] [--use-claude-code] [--create-tickets]"
---

# /simple-requirements:compliance-check Command

Run a comprehensive compliance check before creating a PR, with optional AI analysis and Linear ticket creation for issues found.

## Purpose

The `/simple-requirements:compliance-check` command ensures requirement compliance by:
- Detecting changed requirements (hash mismatches with INDEX.md)
- Identifying outdated implementations in tracking file
- Running AI compliance analysis (optional)
- Offering to create Linear tickets for issues found
- Supporting FDA audit trail requirements

## Usage

```bash
/simple-requirements:compliance-check                    # Basic check
/simple-requirements:compliance-check --with-analysis    # Include AI analysis
/simple-requirements:compliance-check --use-claude-code  # Use Claude Code CLI for AI
/simple-requirements:compliance-check --create-tickets   # Auto-prompt for ticket creation
```

## Arguments

### `--with-analysis` *(optional)*

Enable AI-powered compliance analysis:
- Analyzes if implementations still satisfy requirements
- Provides risk assessment (LOW/MEDIUM/HIGH)
- Suggests required changes
- Requires ANTHROPIC_API_KEY or Claude Code CLI

### `--use-claude-code` *(optional)*

Use Claude Code CLI instead of Anthropic API:
- Uses your existing Claude Code authentication
- No separate API key needed
- Implies `--with-analysis`

### `--create-tickets` *(optional)*

Prompt to create Linear tickets for issues:
- Creates tickets for changed requirements
- Creates tickets for non-compliant implementations
- Links tickets to requirement IDs

## Behavior

### Workflow Steps

1. **Run compliance check script**:
   ```bash
   python3 scripts/pre-pr-compliance-check.py [options]
   ```

2. **Display results** showing:
   - Changed requirements (hash mismatches)
   - Outdated implementations
   - AI analysis results (if enabled)

3. **If issues found**, prompt user:
   - "Would you like to create Linear tickets for these issues?"
   - Options: Yes (create tickets), No (skip), Select specific issues

4. **If user confirms**, create tickets via `linear-api` sub-agent:
   - Title: `[REQ-{id}] Compliance: {summary}`
   - Description: Analysis details and required changes
   - Labels: `compliance`, `requirement-change`

### Example Output

```
# Pre-PR Compliance Check

**Generated**: 2025-12-12 00:30:00

## Summary

| Metric | Count |
|--------|-------|
| Changed Requirements | 2 |
| Outdated Implementations | 1 |
| AI Analyses Run | 3 |

## :warning: Changed Requirements

- **REQ-p00043**: Clinical Diary Mobile Application
  - File: `prd-diary-app.md`
  - Hash: `abc12345` â†’ `def67890`

## :x: Outdated Implementations

- **REQ-d00027**: Containerized Development Environments
  - File: `common.py`
  - Detected: 2025-12-11T20:00:00

---

Would you like to create Linear tickets for these issues?
```

## Implementation

When this command is invoked, execute the following steps:

### Step 1: Run Compliance Check

```bash
cd $REPO_ROOT/tools/anspar-cc-plugins/plugins/simple-requirements/scripts
python3 pre-pr-compliance-check.py --format markdown $ARGS
```

Where `$ARGS` includes:
- `--with-analysis` if user specified or `--use-claude-code` specified
- `--use-claude-code` if user specified

### Step 2: Parse Results

Extract from the output:
- List of changed requirements with IDs and details
- List of outdated implementations
- AI analysis results if available

### Step 3: Display Report

Show the markdown report to the user.

### Step 4: Prompt for Ticket Creation (if issues found)

If any issues were found, use the AskUserQuestion tool:

```
Question: "Would you like to create Linear tickets for these compliance issues?"
Options:
- "Yes, create tickets for all issues"
- "Let me select which issues"
- "No, I'll handle them manually"
```

### Step 5: Create Tickets (if user confirms)

For each issue the user wants tracked:

1. Use the `linear-api` sub-agent to create a ticket:
   ```
   Title: [REQ-{req_id}] Compliance Review: {title}

   Description:
   ## Compliance Issue Detected

   **Requirement**: REQ-{req_id}
   **Type**: {Changed Requirement | Outdated Implementation | Non-Compliant}
   **Risk Level**: {risk_level}

   ### Details
   {analysis_summary}

   ### Required Actions
   {required_changes as checklist}

   ### AI Recommendations
   {recommendations}

   ---
   Auto-generated by compliance-check workflow
   ```

2. Add labels: `compliance`, `requirement-traceability`

3. Report created ticket IDs to user

## Integration with Workflow

This command integrates with the workflow plugin:
- Can be run before `/workflow:release` to verify compliance
- Results can trigger compliance verification tickets
- Supports FDA 21 CFR Part 11 audit requirements

## Related Commands

- `/simple-requirements:changes` - Detect requirement changes only
- `/simple-requirements:report` - Generate detailed compliance reports
- `/linear-api:create` - Create Linear tickets manually
- `/workflow:claim` - Claim a ticket for implementation work
