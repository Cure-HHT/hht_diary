{
  "tests": {
    "metadata": {
      "name": "Plugin Metadata Tests",
      "tests": [
        {
          "name": "Valid plugin.json structure",
          "type": "validation",
          "target": ".claude-plugin/plugin.json",
          "checks": [
            {
              "field": "name",
              "required": true,
              "pattern": {}
            },
            {
              "field": "version",
              "required": true,
              "pattern": {}
            },
            {
              "field": "description",
              "required": true,
              "minLength": 1,
              "maxLength": 500
            },
            {
              "field": "author",
              "required": true,
              "type": "object"
            },
            {
              "field": "author.name",
              "required": true,
              "minLength": 1
            }
          ]
        },
        {
          "name": "Valid marketplace.json if present",
          "type": "validation",
          "target": ".claude-plugin/marketplace.json",
          "optional": true,
          "checks": [
            {
              "field": "plugins",
              "required": true,
              "type": "array"
            },
            {
              "field": "owner",
              "required": true,
              "type": "object"
            }
          ]
        }
      ]
    },
    "commands": [],
    "agents": [],
    "skills": [],
    "hooks": [
      {
        "name": "Hook: PostToolUse",
        "tests": [
          {
            "name": "Hook configuration valid",
            "type": "hook-validation",
            "event": "PostToolUse",
            "command": [
              {
                "matcher": "Write|Edit",
                "hooks": [
                  {
                    "type": "command",
                    "command": "${CLAUDE_PLUGIN_ROOT}/hooks/pre-commit-spec-compliance"
                  }
                ]
              }
            ]
          },
          {
            "name": "Hook script exists if referenced",
            "type": "conditional-file-exists",
            "condition": false,
            "target": "hooks/undefined"
          },
          {
            "name": "Hook execution test",
            "type": "hook-execution",
            "event": "PostToolUse",
            "testEnv": {
              "CLAUDE_TOOL_NAME": "test-tool",
              "CLAUDE_TOOL_PARAMS": "{}"
            },
            "expectedExitCode": 0
          }
        ]
      }
    ],
    "integration": [
      {
        "name": "Plugin loads successfully",
        "type": "plugin-load",
        "pluginPath": ".",
        "expectedComponents": [
          "hooks"
        ]
      },
      {
        "name": "Commands and agents interact correctly",
        "type": "component-interaction",
        "scenario": "Command invokes agent",
        "steps": [
          {
            "action": "invoke-command"
          },
          {
            "verify": "agent-activated"
          }
        ]
      },
      {
        "name": "Error handling works correctly",
        "type": "error-handling",
        "scenarios": [
          {
            "name": "Invalid command arguments",
            "action": "invoke-command",
            "args": [
              "--invalid-arg"
            ],
            "expectedError": true
          },
          {
            "name": "Hook timeout handling",
            "action": "trigger-hook",
            "event": "before-tool-use",
            "simulateTimeout": true,
            "expectedBehavior": "graceful-failure"
          }
        ]
      }
    ]
  },
  "runner": "bash",
  "timeout": 30000
}